#!/bin/bash
set -e

# Always use Python 3.12 for this project
export UV_PYTHON="python3.12"

# If .venv doesn't exist, create it with correct Python
if [ ! -d ".venv" ]; then
    uv venv --python python3.12
fi

# Sanity check: ensure we're not using host Python when running commands
if [[ "$1" == "run" ]] && [[ "$2" == "python" || "$2" == "pytest" || "$2" == "mypy" ]]; then
    # Verify we have a .venv
    if [ ! -f ".venv/bin/python" ]; then
        echo "‚ùå ERROR: .venv not found but trying to run Python commands"
        echo "This would use host Python instead of project Python!"
        exit 1
    fi
fi

# Run uv with all arguments
exec uv "$@"